{ "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://batvault/schemas/policy.decision.json",
  "title": "BatVault Policy Decision Output",
  "type": "object",
  "additionalProperties": false,
  "required": ["allowed_ids", "policy_fp"],
  "properties": {
    "allowed_ids": { "type": "array", "items": { "type": "string", "pattern": "^[^#]+#.+" } },
    "policy_fp":   { "type": "string", "pattern": "^sha256:[0-9a-fA-F]{64}$" },
    "denied_status": { "type": "integer", "enum": [403, 404] },
    "extra_visible": { "type": "array", "items": { "type": "string" } },
    "explain": {
      "type": "object",
      "properties": {
        "field_visibility": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "visible_fields": { "type": "array", "items": { "type": "string" } }
            },
            "required": ["visible_fields"],
            "additionalProperties": false
          }
        },
        "reason": { "type": "string" }
      }
    }
  } }