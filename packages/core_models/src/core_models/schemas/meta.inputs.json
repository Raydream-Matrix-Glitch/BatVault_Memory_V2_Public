{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://batvault.dev/schemas/meta.inputs.json",
  "title": "Meta Inputs",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "request","policy","budgets","fingerprints",
    "evidence_counts","evidence_sets","selection_metrics",
    "truncation_metrics","runtime"
  ],
  "properties": {
    "policy_trace": { "type": "object", "additionalProperties": true },
    "request": {
      "type": "object",
      "additionalProperties": false,
      "required": ["intent", "ts_utc"],
      "properties": {
        "intent":   { "type": "string", "minLength": 1 },
        "id":       { "type": "string" },
        "anchor_id":{ "type": "string" },
        "request_id":{ "type": "string" },
        "trace_id": { "type": "string" },
        "span_id":  { "type": "string" },
        "ts_utc":   { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$" }
      },
      "oneOf": [
        { "required": ["id"] },
        { "required": ["anchor_id"] }
      ]
    },
    "policy": {
      "type": "object",
      "additionalProperties": true,
      "required": ["policy_id"],
      "properties": {
        "policy_id": { "type": "string", "minLength": 1 }
      }
    },
    "budgets":            { "type": "object", "additionalProperties": true },
    "fingerprints": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "graph_fp": { "type": "string", "pattern": "^sha256:[0-9a-f]{64}$" }
      }
    },
    "evidence_counts":    { "type": "object", "additionalProperties": true },
    "evidence_sets":      { "type": "object", "additionalProperties": true },
    "selection_metrics":  { "type": "object", "additionalProperties": true },
    "truncation_metrics": { "type": "object", "additionalProperties": true },
    "runtime":            { "type": "object", "additionalProperties": true },
    "load_shed":          { "type": "boolean" }
  }
}