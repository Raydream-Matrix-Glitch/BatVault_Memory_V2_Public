ENVIRONMENT=dev
SERVICE_LOG_LEVEL=INFO
REQUEST_LOG_SAMPLE_RATE=1.0

# --- signing (dev) -----------------------------------------------------------
GATEWAY_SIGN_KEY_ID=gateway/k1
GATEWAY_ED25519_PRIV_B64=O8S0OitT9BdpBEr6jVZOJ0ubAadWbqveYgcKM9ZifLw=
GATEWAY_ED25519_PUB_B64=CuJO/uHaLMV/Af5/jCNLuVuEuVlg1ndWAJlyASpFQdc=
GATEWAY_SIGNING_REQUIRED=1

# ---------- Auth ----------
# Turn auth on/off for local dev or demos (disable only in trusted environments).
AUTH_DISABLED=true

# ---------- API Edge ----------
# Public API service knobs and upstream routing to Gateway.
API_EDGE_PORT=8080
API_EDGE_UPSTREAM_BASE=http://gateway:8081
EDGE_RL_EXCLUDE_PATHS=healthz,readyz,metrics  # paths excluded from rate limiting
EDGE_PROXY_TIMEOUT_MS=45000                    # generous read-timeout for streamed /v2/query
EDGE_PROXY_RETRY_MULTIPLIER=1.5               # one-shot retry timeout multiplier for timeouts

# ---------- Gateway ----------
# Gateway-specific operational settings.
GATEWAY_LOAD_SHED_REFRESH_MS=300              # how often load-shed state refreshes

# ---------- CORS & Frontend ----------
# FE should prefer same-origin (API Edge). Gateway base is discovered at runtime via /config on the Edge.
VITE_GATEWAY_BASE=
VITE_API_BASE=http://localhost:8080
VITE_MEMORY_BASE=http://localhost:8082

PROXY_HEADERS=1

# ---------- Performance Budgets (ms) ----------
# Soft targets for user-visible latency used in dashboards and tuning.
PERF_ASK_P95_MS=3000
PERF_QUERY_P95_MS=4500

# ---------- Stage Timeouts (ms) ----------
# Hard time limits per internal step to prevent slow cascades.
TIMEOUT_ENRICH_MS=1200
TIMEOUT_EXPAND_MS=400
TIMEOUT_LLM_MS=30000                           # read-timeout for Gatewayâ†’LLM hop
TIMEOUT_VALIDATE_MS=300                        # JSON/contract validation budget

# ---------- Feature Flags ----------
# Toggle major behaviors to test features safely.
ENABLE_SELECTOR_MODEL=true
ENABLE_LOAD_SHEDDING=true
ENABLE_GRAPH_EMBEDDINGS=false
ENABLE_ARTIFACT_RETENTION=true
ENABLE_CACHING=true

# ---------- Token-Aware Budgets (router & selector) ----------
# How much context the model can handle and how big the completion should be.
CONTROL_CONTEXT_WINDOW=2048
CONTROL_COMPLETION_TOKENS=512
CONTROL_PROMPT_GUARD_TOKENS=32
SELECTOR_TRUNCATION_THRESHOLD_TOKENS=1200

# ---------- Evidence Size Budgets ----------
# Limits and heuristics for how much evidence to pass into prompts.
MIN_EVIDENCE_ITEMS=1
GATE_COMPLETION_SHRINK_FACTOR=0.8
GATE_SHRINK_JITTER_PCT=0.15
GATE_MAX_SHRINK_RETRIES=2

# ---------- Cache TTLs ----------
# How long different cached items should live to balance speed vs. freshness.

# ---------- Resolver ----------
# Candidate source (BM25) and optional cross-encoder rerank.
RESOLVER_TOP_K=24
RERANK_ENABLE=1
RERANK_PAIR_MAX=10
RERANK_MARGIN=1e-6
RERANK_TIMEOUT_MS=50
CROSS_ENCODER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2

# ---------- Internal Service URLs ----------
# Where internal components talk to each other.
MEMORY_API_BASE=http://memory_api:8000
MEMORY_API_URL=http://memory_api:8000
# ---------- OPA (Policy-as-Code) ----------
# Docker image tag (centralized); override as needed.
OPA_IMAGE=openpolicyagent/opa:0.67.1
# URL for Gateway/Memory to contact OPA. Enables OPA externalization when set.
OPA_URL=http://opa:8181
# OPA decision path and timeout (optional overrides)
OPA_DECISION_PATH=/v1/data/batvault/decision
OPA_TIMEOUT_MS=1000

# ---------- Redis ----------
# Fast in-memory store for caching and rate limits.
REDIS_URL=redis://redis:6379/0

# ---------- Arango ----------
# Graph + document database settings (and vector index toggles).
ARANGO_URL=http://arangodb:8529
ARANGO_DB=batvault
ARANGO_ROOT_USER=root
ARANGO_ROOT_PASSWORD=batvault
ARANGO_VECTOR_INDEX_ENABLED=true
EMBEDDING_DIM=768
VECTOR_METRIC=cosine
FAISS_NLISTS=100

# ---------- MinIO ----------
# Object storage for artifacts and logs.
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=batvault-artifacts
MINIO_REGION=us-east-1
MINIO_RETENTION_DAYS=14
MINIO_SECURE=false
MINIO_PUBLIC_ENDPOINT=http://localhost:9000
# Async uploader timeout (seconds) to keep query path snappy; uploader runs off-thread.
MINIO_ASYNC_TIMEOUT=10

# MinIO retry knobs (used by named-bundle and index uploads)
MINIO_MAX_RETRIES=3
MINIO_RETRY_BASE_MS=50
MINIO_RETRY_JITTER_MS=200
MINIO_RETRY_CAP_MS=2000

# ---------- Answer shaping ----------
# Canonical budgets (prefer these over legacy)
SHORT_ANSWER_MAX_SENTENCES=3
# How many events to summarise in the 'Because ...' clause (0-3 is sane)
BECAUSE_EVENT_COUNT=2

# ---------- LLM Endpoints & Models ----------
LLM_ENDPOINT=http://vllm-control:8010
CONTROL_MODEL_ENDPOINT=http://vllm-control:8010
LLM_MODE=auto
ASK_LLM_MODE=off    # ASK deterministic by default (templater unless explicitly overridden)
QUERY_LLM_MODE=auto
VLLM_MODEL_NAME=Qwen/Qwen2-7B-Instruct-AWQ      # control model
TGI_MODEL_ID=Qwen/Qwen2-7B-Instruct             # standard TGI model
TEI_MODEL_NAME=BAAI/bge-base-en-v1.5            # embeddings model
ENABLE_EMBEDDINGS=true
EMBEDDINGS_ENDPOINT=http://tei-embed:8085
EMBEDDINGS_DIMS=768
OPENAI_DISABLED=0
HF_TOKEN=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
CITE_ALL_IDS=false                               # validator: enforce allowed IDs only

# ---------- API Rate Limiting ----------
# Default request rate limits (adjust per environment).
API_RATE_LIMIT_DEFAULT=100/minute

# ---------- Observability ----------
# OpenTelemetry / collector config and logging levels.
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4318
COLLECTOR_OTLP_ENABLED=true
OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf
OTEL_PROPAGATORS=tracecontext,baggage
OTEL_TRACES_SAMPLER=parentbased_always_on
OTEL_LOG_LEVEL=error

# ---------- Compose & Infra Defaults ----------
# Extra runtime defaults typically set in docker-compose.
GF_AUTH_ANONYMOUS_ENABLED=true
GF_AUTH_ANONYMOUS_ORG_ROLE=Viewer
GF_LOG_FILTERS=authn.service:info
MINIO_ROOT_USER=${MINIO_ACCESS_KEY}
MINIO_ROOT_PASSWORD=${MINIO_SECRET_KEY}
HF_HOME=/data/hf
PYTHONUNBUFFERED=1

# ---------- Core HTTP Client Backoff ----------
# Small jittered retries for upstream HTTP calls.
HTTP_RETRY_BASE_MS=50
HTTP_RETRY_JITTER_MS=200

# ---------- Ingest ----------
# Where the ingest service sends its internal requests.
INGEST_UPSTREAM_BASE=http://gateway:8081
CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
GATEWAY_PUBLIC_BASE=http://localhost:8081